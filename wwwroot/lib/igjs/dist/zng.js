(()=>{"use strict";String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),e)},String.prototype.toPascalCase=function(){return this.replace(new RegExp(/[-_]+/,"g")," ").replace(new RegExp(/[^\w\s]/,"g"),"").replace(new RegExp(/\s+(.)(\w+)/,"g"),((t,e,n)=>`${e.toUpperCase()+n.toLowerCase()}`)).replace(new RegExp(/\s/,"g"),"").replace(new RegExp(/\w/),(t=>t.toUpperCase()))},String.prototype.toCamelcase=function(){return this.replace(/(?:^\w|[A-Z]|\b\w)/g,(function(t,e){return 0==e?t.toLowerCase():t.toUpperCase()})).replace(/\s+/g,"")},Number.prototype.toHhMmSs=function(){let t=this,e=Math.floor(t/3600),n=Math.floor((t-3600*e)/60),i=t-3600*e-60*n;return e<10&&(e="0"+e),n<10&&(n="0"+n),i<10&&(i="0"+i),e+":"+n+":"+i},String.prototype.toHhMmSs=function(){return parseInt(this,10).toHhMmSs()},String.prototype.createButton=function(t,e="",n=""){let i=getRight();return'<a data-parent="'+n+'" data-prefix="'+e+'" data-ar="'+this+'" href="" class="ml-2 btn btn-primary create-z'+(checkAr(i,this).create?"":" disabled-z")+'" title="Create"><i class="fas fa-plus"></i> '+t+"</a>"},String.prototype.uploadButton=function(t){let e=getRight();return'<a data-ar="'+this+'" href="" class="ml-2 btn btn-primary upload-z'+(checkAr(e,this).create?"":" disabled-z")+'" title="Upload"><i class="fas fa-upload"></i> '+t+"</a>"},String.prototype.syncButton=function(t){let e=getRight();return'<a data-ar="'+this+'"  class="ml-2 btn btn-primary sync-z'+(checkAr(e,this).create?"":" disabled-z")+'" title="Sync"><i class="fas fa-sync"></i> '+t+"</a>"},String.prototype.modalButton=function(t,e,n,i){let a=getRight(),o=checkAr(a,this).create?"":" disabled-z";return'<a data-ar="'+this+'" data-toggle="modal" data-target="#'+e+'" id="'+n.replace("Modal","Btn")+'""  class="ml-2 btn btn-primary'+o+'" title="'+t+'"><i class="'+i+'"></i> '+t+"</a>"},String.prototype.updateButton=function(t,e,n=""){let i=getRight();return'<a data-id="'+t+'" data-prefix="'+n+'" data-ar="'+this+'" href="" class="ml-2 btn btn-warning update-z'+(checkAr(i,this).edit?"":" disabled-z")+'" title="Update"><i class="fas fa-edit"></i> '+e+"</a>"},String.prototype.detailButton=function(t,e,n=""){let i=getRight();return'<a data-id="'+t+'" data-prefix="'+n+'" data-ar="'+this+'" href="" class="ml-2 btn btn-info view-z'+(checkAr(i,this).read?"":" disabled-z")+'" title="Detail"><i class="fas fa-search"></i> '+e+"</a>"},String.prototype.viewButton=function(t){let e=getRight();return'<a data-id="'+t+'" data-ar="'+this+'" href="" class="btn btn-sm btn-primary btn-hover view-z'+(checkAr(e,this).read?"":" disabled-z")+'" title="View"><i class="fas fa-eye fa-sm"></i></a>'},String.prototype.viewLink=function(t,e){let n=getRight();return'<a data-id="'+t+'" data-ar="'+this+'" style="white-space: break-spaces;" class="'+(checkAr(n,this).read?"view-z":"")+'" title="View">'+e+"</a>"},String.prototype.editButton=function(t){let e=getRight();return'<a data-id="'+t+'" data-ar="'+this+'" href="" class="btn btn-sm btn-warning btn-hover update-z'+(checkAr(e,this).edit?"":" disabled-z")+'" title="Update"><i class="fas fa-edit fa-sm"></i></a>'},String.prototype.deleteButton=function(t,e=""){let n=getRight();return'<a data-id="'+t+'" data-prefix="'+e+'" data-ar="'+this+'" href="" class="btn btn-sm btn-danger btn-hover delete-z'+(checkAr(n,this).delete?"":" disabled-z")+'" title="Delete"><i class="fas fa-trash"></i></a>'},String.prototype.emailButton=function(t){return'<a class="btn btn-sm btn-danger btn-hover" href="mailto:'+t+'" title="Send Email"><i class="fas fa-envelope"></i></a>'},String.prototype.callButton=function(t){return'<a class="btn btn-sm btn-info btn-hover" href="tel:'+t+'" title="Call"><i class="fas fa-phone-square"></i></a>'},String.prototype.noteButton=function(t){return'<a data-id="'+t+'" class="btn btn-sm btn-hover text-red btn-red" title="Notes"  data-toggle="modal" data-target="#profileNotes" ><i class="fas fa-comment"></i></a>'},String.prototype.checkPermission=function(t,e){let n=getRight(),i=checkAr(n,this),a=i.none;return"create"==e&&(a=i.create),"read"==e&&(a=i.read),"update"==e&&(a=i.edit),"delete"==e&&(a=i.delete),a?"delete"!=e&&(window.location.href=t):swal({title:"No permission",text:"You don't have permission to access this function.",icon:"info"}),a},String.prototype.getDataTableSetting=function(t,e,n=null){let i=this;return{order:[],paging:!0,pageLength:DtPageSize,lengthMenu:DtPageSizeList,serverSide:!0,processing:!0,searching:!1,pagingType:"full_numbers",language:{loadingRecords:"&nbsp;",processing:'<div id="LoadingZ" class="m-loader m-loader--brand m-loader--right m-loader--lg">Loading... </div>'},dom:"<'row'<'col-sm-12'tr>>\n\t\t\t<'row'<'col-sm-12 col-md-4'i><'col-sm-12 col-md-8 dataTables_pager'lp>>",listAction:{disableResponseHtmlEncoding:!0,ajaxFunction:function(t){let e=/^.*\?.*$/.test(i),a=buildQuery(t,!e);return $.ajax({method:"GET",headers:{Authorization:n},url:i+a}).fail((t=>{let e="";0==t.status&&(e=EM994+" (API)"),401==t.status&&(e=EM996),e='<div class="alert alert-danger" role="alert">'+e+"</div>",$("#LoadingZ").html(e)})).catch({})},inputFilter:t},columnDefs:e}},String.prototype.loadDataTable=function(t,e,n,i="Read",a=null){let o=this;if(isEmpty(t))return;if($.fn.DataTable.isDataTable(o))return void $(o).DataTable().ajax.reload();let s=(t+i).getDataTableSetting(e,n,a);$(o).DataTable(s)},String.prototype.getApiSite=function(t,e="api"){return isEmpty(e)||(e+="/"),t+"/"+e+this.replace("Syn","")+"/"},String.prototype.getApiUrl=function(t=""){return isEmpty(t)||(t+="/"),"/"+t+this+"/"},Number.prototype.getVisible=function(t=!0){let e="";if(0<=this&&this<=3){let n={0:{name:"Hidden",display:"Tab Hidden"},1:{name:"Off",display:"Default Off"},2:{name:"On",display:"Default On"}}[this];e=t?n.display:n.name}return e},Number.prototype.toPermisObj=function(){let t={none:!0,read:!1,create:!1,edit:!1,delete:!1,viewAll:!1,modifyAll:!1,full:!1},e=1&this;return t.read=1==e,e=2&this,t.create=2==e,e=4&this,t.edit=4==e,e=8&this,t.delete=8==e,e=1&this,t.viewAll=1==e,e=13&this,t.modifyAll=13==e,e=t.read||t.create||t.edit||t.delete||t.viewAll||t.modifyAll,t.none=!e,t.full=t.modifyAll&&t.create,t},Number.prototype.toPermisSte=function(){let t={none:!0,access:!1,createUser:!1,updateUser:!1,resetPassword:!1,loginAs:!1,useSiteProfile:!1,syncData:!1,full:!1},e=1&this;return t.access=1==e,e=2&this,t.createUser=2==e,e=4&this,t.updateUser=4==e,e=8&this,t.resetPassword=8==e,e=16&this,t.loginAs=16==e,e=32&this,t.useSiteProfile=32==e,e=64&this,t.syncData=64==e,e=t.access||t.createUser||t.updateUser||t.resetPassword||t.loginAs||t.useSiteProfile||t.syncData,t.none=!e,t.full=t.access&&t.createUser&&t.updateUser&&t.resetPassword&&t.loginAs&&t.useSiteProfile&&t.syncData,t},String.prototype.toBool=function(){let t=null;if(isEmpty(this))return t;try{t=JSON.parse(this.toLowerCase())}catch(e){t=null}return t},String.prototype.toParam=function(){let t=window.location.search.substring(1),e=new URLSearchParams(t).get(this);return"null"==e&&(e=null),e},String.prototype.makeVm=function(){let t=this,e=JSON.parse(t);e.mode=null,e.timezoneOffset=getTimezone();let n=t.replaceAll('""',"true"),i=JSON.parse(n);return i.submit=!1,i.processing=!1,i.loaded=!1,i.error=!1,n=t.replaceAll('""',"false"),{vm:e,valid:i,inline:JSON.parse(n)}},String.prototype.isDomain=function(){let t=window.location.hostname==this,e=window.location.hostname=="www."+this;return t||e},(()=>{var t,e=null,n=null,i=null,a=!0,o=new Array,s="ActionTab",r="ClientId",l="SessionId",c="TabId",u=1,d=60*u,p=!1,h=0,g=0,f=0,m=new Array,b=new Array;function w(){let t=a?"active":"inactive",e=window.location.pathname,s="-------------------------- > ",c=s+"Path ["+e+"] is <b>"+t.toUpperCase()+"</b>",u=o.find((t=>t.path===e));null!=u&&(c+="<br/>"+s+" Time ACTIVE: "+u.timeActive+"s, INACTIVE: "+u.timeInactive+'s, session expired in <span style="color:red">'+d.toHhMmSs()+"</span>",c+="<br/>"+s+" Tab ID: "+u.uid,c+="<br/>"+s+" Start   active: "+u.startActive,c+="<br/>"+s+" Start inactive: "+u.startInactive,c+="<br/>"+s+" Last    active: "+u.lastActive,c+="<br/>"+s+" Last  inactive: "+u.lastInactive);let p=getCookie(r),h=getCookie(l);c+=")<br/>"+s+" Client  ID: "+p,c+="<br/>"+s+" Session ID: <b>"+(null==h?"EXPIRED":h)+"</b>",null==n&&(n=p),null==i&&(i=h),(null==h||d<=0)&&y("CloseSession");let w=window.screen.height,S=window.screen.width;c+="<br/>"+s+" Screen (h,w) = ("+w+","+S,m=[w,S];let v=$(window).height(),A=$(window).width();c+=") | Window (h,w) = ("+v+","+A;let k=[v,A],C=$(document).height(),I=$(document).width();c+=")<br/>"+s+" Document (h,w) = ("+C+","+I;let z=[C,I];c+=") | Mouse (x,y) = ("+g+","+f+")";let D=[g,f];b.length>0?b[0].mousePosition.push(D):b=[{windowSize:k,documentSize:z,mousePosition:[D]}],$("#zlog").html(c)}function y(a){if(null==e)return;p&&console.log("Calling "+a+"...");let o=v(),r={clientId:n,sessionId:i,sessionExpired:"CloseSession"==a,sessionClosed:"CloseTab"==a,tabs:[o],screenSize:m,mouseInfos:b,browser:detectBrowser()};(r.sessionExpired||r.sessionClosed)&&(i=null,setStorageS(s,null),clearInterval(t));let l=JSON.stringify(r);e.invoke(a,l).then((function(){p&&console.log("Called "+a+"...")})).catch((function(t){console.log(t.message)}))}function S(t){let e=new Date,n=v();null==n?(n=new I(window.location.pathname),n.uid=getCookie(c),t?n.lastActive=e:n.lastInactive=e,o.push(n)):t?n.lastActive=e:n.lastInactive=e,setStorageS(s,o)}function v(){let t=getStorageS(s);null!=t&&(o=t);let e=window.location.pathname;return o.find((t=>t.path===e))}function A(t){t.timeActive+=1,t.lastActive=new Date,d=60*u;let e=getCookie(l);setCookie(l,e,u),e=getCookie(c),setCookie(c,e,u)}function k(t){t.timeInactive+=1,t.lastInactive=new Date,null==t.startInactive&&(t.startInactive=t.lastInactive)}function C(t){let e,n,i;null==(t=t||window.event).pageX&&null!=t.clientX&&(e=t.target&&t.target.ownerDocument||document,n=e.documentElement,i=e.body,t.pageX=t.clientX+(n&&n.scrollLeft||i&&i.scrollLeft||0)-(n&&n.clientLeft||i&&i.clientLeft||0),t.pageY=t.clientY+(n&&n.scrollTop||i&&i.scrollTop||0)-(n&&n.clientTop||i&&i.clientTop||0)),g=t.pageX,f=t.pageY}setStorageS(s,null),$((function(){$.ajax({method:"GET",url:"/../api/SysUser/GetConfig"}).done((t=>{if(t.success){let n=t.data;setConfig(n),s=n.keyActionTab,r=n.keyClientId,l=n.keySessionId,c=n.keyTabId,u=n.sessionCookie,p=n.zLogUi,(e=(new signalR.HubConnectionBuilder).withUrl(n.basePath+"/CounterHub").build()).on("ReceiveMessage",(function(t,e){console.log(t+": "+e+"\n")})),e.on("DoItNow",(function(t,e,n){console.log(t+": "+e+", data:"+n+"\n"),$(t).val(n),"click"==e&&$(t).click(),"keypress"==e&&$(t).keypress()})),e.start().then((function(){console.log("Starting counter online...")})).catch((function(t){return console.error(t.toString())}));let i=new URL(window.location.href);(p=""==i.searchParams.get("zlog")||p)&&$("#zlog").show()}else console.log(t.message)}));let n=!1,i=null;$("*").bind("mousemove click mouseup mousedown keydown keypress keyup submit change mouseenter scroll resize dblclick",(function(){1==n&&(a=!0),n=!1,clearTimeout(i),i=setTimeout((function(){a=!1,n=!0}),2e3)})),$("body").trigger("mousemove"),document.onmousemove=C,window.onbeforeunload=function(){y("CloseTab")},window.onfocus=function(){S(a=!0)},window.onblur=function(){S(a=!1)},clearInterval(t),t=setInterval((function(){!function(t){let e=v();null==e?(e=new I(window.location.pathname),e.uid=getCookie(c),t?A(e):k(e),o.push(e)):t?A(e):k(e),setStorageS(s,o)}(a),h%10==0&&(h=0,y("UpdateTab")),h++,--d<=0&&clearInterval(t),w()}),1e3),w()}));class I{constructor(t){this.path=t,this.uid=null,this.timeActive=0,this.timeInactive=0,this.startActive=new Date,this.startInactive=null,this.lastActive=null,this.lastInactive=null}}})()})();